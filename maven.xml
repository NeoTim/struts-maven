<?xml version="1.0"?>

<project    default="build-all"
            xmlns:j="jelly:core"
            xmlns:ant="jelly:ant"
            xmlns:maven="jelly:maven">

	<tstamp>
		<format property="today" pattern="yyyy-MM-dd"/>
	</tstamp>

	<goal name="nightly">
	  <attainGoal name="clean-all"/>
	  <attainGoal name="build-all"/>

	  <ant:copy todir="${today}">
		<ant:fileset dir="../apps/blank/target/">
	        <ant:include name="struts-blank.war"/>
		</ant:fileset>
	  </ant:copy>

	  <ant:copy todir="${today}">
		<ant:fileset dir="../apps/shared/target/">
	        <ant:include name="struts-mailreader.war"/>
		</ant:fileset>
	  </ant:copy>

	  <ant:copy todir="${today}">
		<ant:fileset dir="../apps/examples/target/">
	        <ant:include name="struts-examples.war"/>
		</ant:fileset>
	  </ant:copy>

	</goal>


	<goal name="build-all">
		  	<maven:reactor
			      basedir="../"
			      includes="*/project.xml"
			      excludes="build/project.xml"
			      goals="dist"
			      banner="Building nightlies"
		      ignoreFailures="true"/>

	</goal>


	<goal name="clean-all">

		  	<maven:reactor
			      basedir="../"
			      includes="*/project.xml"
			      excludes="build/project.xml"
			      goals="clean"
			      banner="Building nightlies"
		      ignoreFailures="true"/>
		  	
	</goal>


	<postGoal name="dist:prepare-bin-filesystem">
		<!-- Copy Instructions and Readmes -->
		<ant:copy todir="${maven.dist.bin.assembly.dir}">
		  <ant:fileset dir="build/">
			<ant:include name="README*"/>
			<ant:include name="LICENSE*"/>
			<ant:include name="STATUS*"/>
			<ant:include name="INSTALL*"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy todir="../build/${today}/${pom.artifactId}-${pom.currentVersion}">
		  <ant:fileset dir="${maven.build.dir}/distributions">
			<ant:include name="*"/>
		  </ant:fileset>
		</ant:copy>

	</postGoal>

  <postGoal name="dist:prepare-src-filesystem">
    <!-- Copy Instructions and Readmes -->
    <ant:copy todir="${maven.dist.src.assembly.dir}">
      <ant:fileset dir="build">
        <ant:include name="README*"/>
        <ant:include name="LICENSE*"/>
        <ant:include name="STATUS*"/>
        <ant:include name="INSTALL*"/>
      </ant:fileset>
    </ant:copy>

    <!-- Copy Maven Control files -->
    <ant:copy todir="${maven.dist.src.assembly.dir}/build">
      <ant:fileset dir="build">
        <ant:include name="project.*"/>
        <ant:include name="*.xml"/>
        <ant:include name="*.jsl"/>
      </ant:fileset>
    </ant:copy>
  </postGoal>
</project>